{% extends "header_footer.html" %}
 {% load static %}

{% block title%}Auction{%endblock %}
{% block content %}
    <!-- Start Breadcrumb section -->
    <div class="breadcrumb-section seven" style="background-image:url({% static "assets/img/inner-pages/breadcrumb-bg7.png" %});">  
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="banner-content">
                        <h1>Auction </h1>
                        <ul class="breadcrumb-list">
                            <li><a href="{% url 'home' %}">Home</a></li>
                            <li>Auction</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Breadcrumb section -->

    <!-- Start Auction Grid section (No Sidebar) -->
    <div class="auction-grid-sidebar-section pt-110 mb-110">
        <div class="container">
            <div class="row">
                <!-- Main Content takes full width -->
                <div class="col-xl-12 order-1">
                    <div class="auction-grid-title-section mb-40">
                        {% if page_obj.paginator.count %}
                        <h6>
                            Showing {{ page_obj.start_index }}–{{ page_obj.end_index }} of {{ page_obj.paginator.count }} results
                        </h6>
                        {% else %}
                        <h6>No results found</h6>
                        {% endif %}
                        <div class="filter-selector">
                            <!-- START: Combined Filter Form - Will automatically carry all parameters -->
                            <form method="get" class="d-flex align-items-center flex-wrap gap-2">
                                <div class="selector">
                                    <select name="status" onchange="this.form.submit()">
                                        <option value="">All Status</option>
                                        <option value="live" {% if selected_status == 'live' %}selected{% endif %}>Live</option>
                                        <option value="upcoming" {% if selected_status == 'upcoming' %}selected{% endif %}>Upcoming</option>
                                        <option value="closed" {% if selected_status == 'closed' %}selected{% endif %}>Closed</option>
                                    </select>
                                </div>
                                <div class="selector">
                                    <select name="category" onchange="this.form.submit()">
                                        <option value="">All Categories</option>
                                        {% for cat in categories %}
                                            <option value="{{ cat.id }}" {% if selected_category_id|default:'' == cat.id|stringformat:'s' %}selected{% endif %}>
                                                {{ cat.name }}
                                            </option>
                                        {% endfor %}
                                    </select>
                                </div>

                                <div class="selector">
                                    <input type="text"
                                           name="q"
                                           value="{{ search_q|default:'' }}"
                                           placeholder="Search products..."
                                           style="padding: 6px 10px; border: 1px solid #191717ff; border-radius: 18px; min-width: 200px;">
                                </div>
                                <button type="submit" class="primary-btn" style="background:black;padding: 9px 20px; border-radius: 12px;">
                                    Apply
                                    <span></span>
                                </button>
                            </form>
                            <!-- END: Combined Filter Form -->
                            <ul class="grid-view d-lg-flex d-none">
                                <li class="column-2">
                                    <!-- Grid 2 View Icon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="20" viewBox="0 0 12 20">
                                        <g>
                                            <rect width="4.88136" height="5.10638" rx="2.44068" />
                                            <rect y="7.44678" width="4.88136" height="5.10638" rx="2.44068" />
                                            <rect y="14.8937" width="4.88136" height="5.10638" rx="2.44068" />
                                            <rect x="7.11865" width="4.88136" height="5.10638" rx="2.44068" />
                                            <rect x="7.11865" y="7.44678" width="4.88136" height="5.10638" rx="2.44068" />
                                            <rect x="7.11865" y="14.8937" width="4.88136" height="5.10638" rx="2.44068" />
                                        </g>
                                    </svg>
                                </li>
                                <li class="column-3">
                                     <!-- Grid 4 View Icon (Changed to be the active one to match product columns) -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                                        <g clip-path="url(#clip0_1610_1442)">
                                            <rect width="5.10638" height="5.10638" rx="2.55319" />
                                            <rect y="7.44678" width="5.10638" height="5.10638" rx="2.55319" />
                                            <rect y="14.8937" width="5.10638" height="5.10638" rx="2.55319" />
                                            <rect x="7.44678" width="5.10638" height="5.10638" rx="2.55319" />
                                            <rect x="7.44678" y="7.44678" width="5.10638" height="5.10638" rx="2.55319" />
                                            <rect x="7.44678" y="14.8937" width="5.10638" height="5.10638" rx="2.55319" />
                                            <rect x="14.8936" width="5.10638" height="5.10638" rx="2.55319" />
                                            <rect x="14.8936" y="7.44678" width="5.10638" height="5.10638" rx="2.55319" />
                                            <rect x="14.8936" y="14.8937" width="5.10638" height="5.10638" rx="2.55319" />
                                        </g>
                                    </svg>
                                </li>
                                <li class="column-4 active">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                                        <g clip-path="url(#clip0_1610_1453)">
                                        <rect width="3.64741" height="3.64741" rx="1.8237"/>
                                        <rect y="8.17627" width="3.64741" height="3.64741" rx="1.8237"/>
                                        <rect y="16" width="3.64741" height="3.64741" rx="1.8237"/>
                                        <rect x="5.31909" width="3.64741" height="3.64741" rx="1.8237"/>
                                        <rect x="5.31909" y="8.17627" width="3.64741" height="3.64741" rx="1.8237"/>
                                        <rect x="5.31909" y="16" width="3.64741" height="3.64741" rx="1.8237"/>
                                        <rect x="10.6382" width="3.64741" height="3.64741" rx="1.8237"/>
                                        <rect x="16.3525" width="3.64741" height="3.64741" rx="1.8237"/>
                                        <rect x="10.6384" y="8.17627" width="3.64741" height="3.64741" rx="1.8237"/>
                                        <rect x="16.3525" y="8.17627" width="3.64741" height="3.64741" rx="1.8237"/>
                                        <rect x="10.6382" y="16" width="3.64741" height="3.64741" rx="1.8237"/>
                                        <rect x="16.3525" y="16" width="3.64741" height="3.64741" rx="1.8237"/>
                                        </g>
                                    </svg>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="list-grid-product-wrap">
                        <div class="row g-4 mb-60">
                            {% for product in page_obj %}
                            <!-- CHANGE: col-lg-4 to col-lg-3 for 4 products per row -->
                            <div class="col-lg-3 col-md-6 item wow animate fadeInDown" data-wow-delay="200ms" data-wow-duration="1500ms">
                                <div class="auction-card style-7">
                                    <div class="auction-card-img-wrap">
                                       <a href="{% url 'auction-details' product.id %}" class="card-img">
                                            {% if product.main_image %}
                                            <img class="product-card-image" src="{{ product.main_image.url }}" alt="{{ product.product_name }}">
                                            {% else %}
                                            <img class="product-card-image" src="{% static 'images/default-product.jpg' %}" alt="No image">
                                            {% endif %}
                                        </a>

                                        <div class="batch">
                                            {% if product.auction_status == "live" %}
                                                <span class="live">
                                                    <svg width="11" height="11" viewBox="0 0 11 11" xmlns="http://www.w3.org/2000/svg"><path d="M10.6777 11H4.83398C4.65599 11 4.51172 10.8557 4.51172 10.6777V10.334C4.51172 9.97798 4.80025 9.68944 5.15625 9.68944V9.30414C5.15625 8.79397 5.57133 8.37889 6.0815 8.37889H9.43022C9.94039 8.37889 10.3555 8.79397 10.3555 9.30414V9.68944C10.7115 9.68944 11 9.97798 11 10.334V10.6777C11 10.8556 10.8556 11 10.6777 11ZM6.96665 7.09722C6.75245 7.38146 6.34829 7.43829 6.06405 7.22402C5.77973 7.00985 5.72299 6.60568 5.93716 6.32134L7.8766 3.74766C8.09087 3.46333 8.49494 3.40659 8.7792 3.62077C9.06353 3.83503 9.12035 4.23911 8.90609 4.52346L6.96665 7.09722ZM2.334 3.60618C2.11973 3.89042 1.71563 3.94725 1.43131 3.73298C1.14707 3.51881 1.09025 3.11473 1.30451 2.83038L3.24397 0.256726C3.45815 -0.027598 3.86231 -0.0844241 4.14657 0.12984C4.43081 0.344103 4.48763 0.748181 4.27337 1.03253L2.334 3.60618ZM3.74767 5.4785C3.27134 5.11956 2.91373 4.67385 2.69008 4.20454L4.94678 1.20984C5.45955 1.29552 5.98651 1.51631 6.46293 1.87534C6.93928 2.23428 7.29689 2.67999 7.52054 3.14921L5.26382 6.14409C4.75108 6.05841 4.22411 5.83751 3.74767 5.4785ZM2.87749 5.56242C3.02753 5.71533 3.18557 5.86196 3.35979 5.99329C3.53409 6.12456 3.71864 6.23606 3.90689 6.33822L3.48668 6.89589L2.45719 6.12018L2.87749 5.56242ZM2.06929 6.63488L3.09878 7.41059L1.15932 9.98436C0.945055 10.2687 0.540977 10.3254 0.256717 10.1112C-0.027607 9.89698 -0.0843477 9.4929 0.12983 9.20856L2.06929 6.63488Z" /></svg> Live
                                                </span>

                                            {% elif product.auction_status == "upcoming" %}
                                                <span style="color:#ffffff;background-color:#00b4d8;">
                                                    <svg width="11" height="11" viewBox="0 0 11 11" xmlns="http://www.w3.org/2000/svg"><path d="M10.6777 11H4.83398C4.65599 11 4.51172 10.8557 4.51172 10.6777V10.334C4.51172 9.97798 4.80025 9.68944 5.15625 9.68944V9.30414C5.15625 8.79397 5.57133 8.37889 6.0815 8.37889H9.43022C9.94039 8.37889 10.3555 8.79397 10.3555 9.30414V9.68944C10.7115 9.68944 11 9.97798 11 10.334V10.6777C11 10.8556 10.8556 11 10.6777 11ZM6.96665 7.09722C6.75245 7.38146 6.34829 7.43829 6.06405 7.22402C5.77973 7.00985 5.72299 6.60568 5.93716 6.32134L7.8766 3.74766C8.09087 3.46333 8.49494 3.40659 8.7792 3.62077C9.06353 3.83503 9.12035 4.23911 8.90609 4.52346L6.96665 7.09722ZM2.334 3.60618C2.11973 3.89042 1.71563 3.94725 1.43131 3.73298C1.14707 3.51881 1.09025 3.11473 1.30451 2.83038L3.24397 0.256726C3.45815 -0.027598 3.86231 -0.0844241 4.14657 0.12984C4.43081 0.344103 4.48763 0.748181 4.27337 1.03253L2.334 3.60618ZM3.74767 5.4785C3.27134 5.11956 2.91373 4.67385 2.69008 4.20454L4.94678 1.20984C5.45955 1.29552 5.98651 1.51631 6.46293 1.87534C6.93928 2.23428 7.29689 2.67999 7.52054 3.14921L5.26382 6.14409C4.75108 6.05841 4.22411 5.83751 3.74767 5.4785ZM2.87749 5.56242C3.02753 5.71533 3.18557 5.86196 3.35979 5.99329C3.53409 6.12456 3.71864 6.23606 3.90689 6.33822L3.48668 6.89589L2.45719 6.12018L2.87749 5.56242ZM2.06929 6.63488L3.09878 7.41059L1.15932 9.98436C0.945055 10.2687 0.540977 10.3254 0.256717 10.1112C-0.027607 9.89698 -0.0843477 9.4929 0.12983 9.20856L2.06929 6.63488Z" /></svg> Upcoming
                                                </span>

                                            {% else %}
                                                <span style="color:#ffffff;background-color:#6c757d;">
                                                    <svg width="11" height="11" viewBox="0 0 11 11" xmlns="http://www.w3.org/2000/svg"><path d="M10.6777 11H4.83398C4.65599 11 4.51172 10.8557 4.51172 10.6777V10.334C4.51172 9.97798 4.80025 9.68944 5.15625 9.68944V9.30414C5.15625 8.79397 5.57133 8.37889 6.0815 8.37889H9.43022C9.94039 8.37889 10.3555 8.79397 10.3555 9.30414V9.68944C10.7115 9.68944 11 9.97798 11 10.334V10.6777C11 10.8556 10.8556 11 10.6777 11ZM6.96665 7.09722C6.75245 7.38146 6.34829 7.43829 6.06405 7.22402C5.77973 7.00985 5.72299 6.60568 5.93716 6.32134L7.8766 3.74766C8.09087 3.46333 8.49494 3.40659 8.7792 3.62077C9.06353 3.83503 9.12035 4.23911 8.90609 4.52346L6.96665 7.09722ZM2.334 3.60618C2.11973 3.89042 1.71563 3.94725 1.43131 3.73298C1.14707 3.51881 1.09025 3.11473 1.30451 2.83038L3.24397 0.256726C3.45815 -0.027598 3.86231 -0.0844241 4.14657 0.12984C4.43081 0.344103 4.48763 0.748181 4.27337 1.03253L2.334 3.60618ZM3.74767 5.4785C3.27134 5.11956 2.91373 4.67385 2.69008 4.20454L4.94678 1.20984C5.45955 1.29552 5.98651 1.51631 6.46293 1.87534C6.93928 2.23428 7.29689 2.67999 7.52054 3.14921L5.26382 6.14409C4.75108 6.05841 4.22411 5.83751 3.74767 5.4785ZM2.87749 5.56242C3.02753 5.71533 3.18557 5.86196 3.35979 5.99329C3.53409 6.12456 3.71864 6.23606 3.90689 6.33822L3.48668 6.89589L2.45719 6.12018L2.87749 5.56242ZM2.06929 6.63488L3.09878 7.41059L1.15932 9.98436C0.945055 10.2687 0.540977 10.3254 0.256717 10.1112C-0.027607 9.89698 -0.0843477 9.4929 0.12983 9.20856L2.06929 6.63488Z" /></svg> 
                                                    Closed
                                                </span>
                                            {% endif %}
                                        </div>
                                        <ul class="view-and-favorite-area">
                                            <li>
                                                <a class="wishlist-toggle-btn 
                                                    {% if product.id in user_wishlist_products %}active{% endif %}"
                                                        href="{% url 'toggle_wishlist' product.id %}"
                                                        aria-label="Toggle Wishlist">
            
                                                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="14" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16">
                                                    <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314"/>
                                                    </svg>
                                                </a>
                                            </li>
   
                                            <li>
                                                <a href="{% url 'auction-details' product.id%}">
                                                    <svg width="17" height="11" viewBox="0 0 17 11"
                                                        xmlns="http://www.w3.org/2000/svg">
                                                        <path fill-rule="evenodd" clip-rule="evenodd"
                                                            d="M15.4028 5.44118C14.0143 7.8425 11.3811 9.33421 8.53217 9.33421C5.68139 9.33421 3.04821 7.8425 1.65968 5.44118C1.55274 5.25472 1.55274 5.05762 1.65968 4.87132C3.04821 2.47003 5.68139 0.978484 8.53217 0.978484C11.3811 0.978484 14.0143 2.47003 15.4028 4.87132C15.5116 5.05762 15.5116 5.25472 15.4028 5.44118ZM16.2898 4.39522C14.7224 1.68403 11.7499 0 8.53217 0C5.31258 0 2.3401 1.68403 0.772715 4.39522C0.492428 4.87896 0.492428 5.43355 0.772715 5.91693C2.3401 8.62812 5.31258 10.3125 8.53217 10.3125C11.7499 10.3125 14.7224 8.62812 16.2898 5.91693C16.5701 5.43358 16.5701 4.87896 16.2898 4.39522ZM8.53217 7.1634C9.68098 7.1634 10.6159 6.26305 10.6159 5.15617C10.6159 4.04929 9.68098 3.14894 8.53217 3.14894C7.38152 3.14894 6.44663 4.04929 6.44663 5.15617C6.44663 6.26305 7.38156 7.1634 8.53217 7.1634ZM8.53217 2.17045C6.82095 2.17045 5.43061 3.50998 5.43061 5.1562C5.43061 6.80278 6.82098 8.14176 8.53217 8.14176C10.2416 8.14176 11.6319 6.80275 11.6319 5.1562C11.6319 3.50998 10.2416 2.17045 8.53217 2.17045Z" />
                                                    </svg>
                                                </a>
                                            </li>
                                        </ul>
                                        <!-- Countdown Timer -->
                                        {% if product.auction_status == "live" %}
                                        <div class="countdown-timer">
                                            <ul data-countdown="{{ product.countdown_start|date:'Y-m-d H:i:s' }}">
                                                    <li class="times" data-days="00">00</li>
                                                    <li class="colon">:</li>
                                                    <li class="times" data-hours="00">00</li>
                                                    <li class="colon">:</li>
                                                    <li class="times" data-minutes="00">00</li>
                                                    <li class="colon">:</li>
                                                    <li class="times" data-seconds="00">00</li>
                                                </ul>
                                            </div>
                                        {%endif%}
                                    </div>

                                    <div class="auction-card-content">
                                        <h6><a href="{% url 'auction-details' product.id %}">{{ product.product_name }}</a></h6>
                                        <div class="price-and-code-area">
                                            <div class="price">
                                                {% if product.auction_status == "live" %}
                                                    <span>Current Bid at:</span>
                                                    <strong>₹{{ product.current_bid }}</strong>
                                                {% elif product.auction_status == "closed" %}
                                                    {%if product.is_sold %}
                                                        <span class="text-danger">Sold Out:</span>
                                                        <strong class="text-danger">₹{{ product.current_bid }}</strong>
                                                    {%else%}
                                                        <span class="text-danger">Not Sold</span>
                                                        <strong class="text-danger">₹{{ product.current_bid }}</strong>
                                                    {%endif%}
                                                {%else%}
                                                    <span style="color:#00b4d8;">Start Bid at:</span>
                                                    <strong style="color:#00b4d8;">₹{{ product.start_price}}</strong>
                                                {%endif%}
                                            </div>
                                            {% if product.auction_status == "live" %}
                                                <a href="{% url 'auction-details' product.id %}" class="bid-btn">Bid Now</a>
                                            {% elif product.auction_status == "closed" %}
                                                {%if product.is_sold %}
                                                    <a href="{% url 'auction-details' product.id %}" class="bid-btn">Sold Out</a>
                                                {%else%}
                                                    <a class="bid-btn" style="background:#dc3545;">Not Sold</a>
                                                {%endif%}
                                            {%else%}
                                                <a href="{% url 'auction-details' product.id %}" class="bid-btn">Coming Soon</a>
                                            {%endif%}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <div class="col-lg-12">
                                <p>No auctions found matching your criteria.</p>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <!-- Paginator Section -->
                        {% if page_obj.paginator.num_pages > 1 %}
                        <div class="row">
                            <div class="col-lg-12 d-flex justify-content-center wow animate fadeInUp" data-wow-delay="400ms" data-wow-duration="1500ms">
                                <div class="inner-pagination-area">
                                    <ul class="paginations">
                                            <!-- Previous Page Link -->
                                            {% if page_obj.has_previous %}
                                            <li class="page-item paginations-button">
                                                <a href="?page={{ page_obj.previous_page_number }}{{ current_query_params }}">
                                                    <svg width="16" height="13" viewBox="0 0 16 13" xmlns="http://www.w3.org/2000/svg">
                                                        <path
                                                            d="M1.34284 10.1026L15.557 1.89603M1.34284 10.1026C4.16124 8.59083 6.21454 3.68154 4.37169 0.489511M1.34284 10.1026C4.16124 8.59083 9.43959 9.2674 11.2824 12.4593" stroke-width="0.96" stroke-linecap="round" transform="scale(-1, 1) translate(-16, 0)"/>
                                                    </svg>
                                                </a>
                                            </li>
                                            {% endif %}
                                            
                                            <!-- Page Number Links (shows a max of 5 pages around current page for cleaner view) -->
                                            {% for num in page_obj.paginator.page_range %}
                                                {% if num == page_obj.number %}
                                                    <li class="page-item active">
                                                        <a href="#">{{ num|stringformat:"02d" }}</a>
                                                    </li>
                                                {% elif num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %}
                                                    <li class="page-item">
                                                        <a href="?page={{ num }}{{ current_query_params }}">{{ num|stringformat:"02d" }}</a>
                                                    </li>
                                                {% endif %}
                                            {% endfor %}

                                            <!-- Next Page Link -->
                                            {% if page_obj.has_next %}
                                            <li class="page-item paginations-button">
                                                <a href="?page={{ page_obj.next_page_number }}{{ current_query_params }}">
                                                    <svg width="16" height="13" viewBox="0 0 16 13" xmlns="http://www.w3.org/2000/svg">
                                                        <path
                                                            d="M15.557 10.1026L1.34284 1.89603M15.557 10.1026C12.9386 8.59083 10.8853 3.68154 12.7282 0.489511M15.557 10.1026C12.9386 8.59083 7.66029 9.2674 5.81744 12.4593" stroke-width="0.96" stroke-linecap="round" />
                                                    </svg>
                                                </a>
                                            </li>
                                            {% endif %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Auction Grid section -->
   
{% endblock %}